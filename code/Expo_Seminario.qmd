---
title: "Anomaly detection in dynamic networks"
author: "Andreina Alamo, Zaith Moreno, Diego Useche"
subtitle: "Seminario I 2024-I"
institute: "Universidad Nacional de Colombia"
format:
  revealjs: 
    center: true
    slide-number: true
    chalkboard: 
      buttons: false
    preview-links: auto
    logo: "logoUN3.PNG"
    #footer: Universidad Nacional de Colombia
editor: visual
# toc: true
toc-title: Contenido
progress: true
---

# Redes

![Visualización de redes (gráfos)](Red1.png){fig-align="center"}

$\bullet$ Red $\bullet$ Grafo $\bullet$ Objetos (vértices o nodos) $\bullet$ Conexiones (enlaces o aristas)$\bullet$ Interacciones (propiedades a nivel global)$\bullet$

## Ejemplos de redes

::: {layout-nrow="2"}
![Estructuras cerebrales](brain.png){width="300" height="300"}

![Redes de trenes](train.png){width="250" height="250"}

![Redes eléctricas](electric.png){width="250" height="250"}

![Redes sociales](social.png){width="300" height="300"}
:::

## Redes dinámicas

![Redes dinámicas (componente temporal)](Red2.png)

## ¿Por qué es importante la detección de anomalías?{.smaller}

-   Accidentes, eventos sospechosos, actividad inusual que merece **investigación adicional**.
-   Los estudios sobre la detección de anomalías en Redes Dinámicas son **limitados**.
-   Existen estudios sobre anomalías en nodos y aristas, o en subgrafos de estructuras de interés, pero no sobre los **puntos en el tiempo** donde se producen estas anomalías.
-   Akoglu (2015) categorizó las técnicas de detección de anomalías en Redes Dinámicas en cuatro grupos: Características, Descomposición, Agrupamiento y Ventanas.

## ***oddnet***

> *Series de tiempo*: tratamiento de patrones estacionales complejos que la similaridad no alcanza a capturar

> *Análisis de redes*: Examinar las caracteristicas (Features) de las redes en el tiempo

> *Reducción de dimensionalidad*:

# Anomalía en redes dinámicas {.smaller}

Considere una secuencia de redes temporales $\left\{\mathcal{G}_t\right\}_{t=1}^T$ donde cada red es un grafo $\mathcal{G}_t=\left(\mathcal{V}_t \mathcal{E}_t\right)$, con $\mathcal{V}_t$ denotando los vértices y $\mathcal{E}_t$ los bordes. Estamos interesados en el proceso general o a largo plazo de generación de redes. Una anomalía se define como un punto con baja probabilidad condicional

$$
\begin{aligned}
p_{t \mid t-1}=\mathcal{P}\left(\mathcal{G}_t \mid \mathcal{G}_1, \ldots, \mathcal{G}_{t-1}\right). 
\end{aligned}
$$ Es decir, un gráfico $\mathcal{G}_t$ es anómalo si su probabilidad de ocurrencia es baja dada la secuencia de gráficos que lo preceden.

## 2.1 Mapeo del espacio de gráficos al espacio de características

Sea $f$ una función de cálculo de características tal que $f: \mathscr{G} \rightarrow \mathbb{R}^n$, donde $\mathscr{G}$ denota el espacio de todas las redes, y sea $x_t$ la imagen de $\mathcal{G}_t$ bajo $f$. Así, $x_t$ es un vector de $n$ características correspondientes a $\mathcal{G}_t:$

$$
x_t=f\left(\mathcal{G}_t\right),
$$

donde $x_t \in \mathbb{R}^n$. Sea $\mathcal{F}$ el codominio de $f$, al cual llamaremos espacio de características.

## 

Este espacio de características $\mathcal{F}$ debe retener aspectos de la distribución del espacio de gráficos $\mathscr{G}$. Así, la probabilidad condicional definida para la detección de anomalías se puede estimar como sigue:

$$
\tilde{p}_{t \mid t-1}=\mathcal{P}\left(x_t \mid x_1, \ldots, x_{t-1}\right).
$$

donde $x_t \in \mathbb{R}^n$.

## Definición 2.1

Una función $f: \mathscr{G} \rightarrow \mathbb{R}^n$ satisface la Condición de Acuerdo Total para un conjunto de gráficos $\left\{\mathcal{G}_t\right\}_{t=1}^T$, si

$$
p_{t \mid t-1}=\tilde{p}_{t \mid t-1} \quad \text { para todo } t \in\{1, \ldots, T\} .
$$

La Condición de Acuerdo Total es la forma más estricta de acuerdo entre los dos espacios $\mathscr{G}$ y $\mathcal{F}$. A continuación, se define una versión más flexible.

## Definición 2.2

Una función $f: \mathscr{G} \rightarrow \mathbb{R}^n$ satisface la Condición de Acuerdo Aproximado con parámetro $\epsilon$, o se dice que es $\epsilon$-aproximada para un conjunto de gráficos $\left\{\mathcal{G}_t\right\}_{t=1}^T$, si

$$
\left|p_{t \mid t-1}-\tilde{p}_{t \mid t-1}\right| \leq \epsilon \quad \text { para todo } t \in\{1, \ldots, T\} ，
$$

donde $\epsilon>0$ y es pequeño.

## Definición 2.3

Una función $f: \mathscr{G} \rightarrow \mathbb{R}^n$ satisface la Condición de Preservación de Anomalías con parámetro $\epsilon$, o se dice que es $\epsilon$-preservadora de anomalías para un conjunto de gráficos $\left\{\mathcal{G}_t\right\}_{t=1}^T$, si y solo si $p_{t \mid t-1} \leq \epsilon_1$ implica que existe $\epsilon_2>0$ con $\epsilon=\max \left(\epsilon_1, \epsilon_2\right)$ tal que $\tilde{p}_{t \mid t-1} \leq \epsilon_2$. Es decir,

$$
p_{t \mid t-1} \leq \epsilon_1 \Longleftrightarrow \tilde{p}_{t \mid t-1} \leq \epsilon_2
$$

donde tanto $\epsilon_1$ como $\epsilon_2$ son pequeños.

## Lema 2.1

Las condiciones de acuerdo están anidadas, es decir, Condición de Acuerdo Total $\Rightarrow$ Condición de Acuerdo Aproximado, Condición de Acuerdo Aproximado $(\epsilon / 2) \Rightarrow$ Condición de Preservación de Anomalías $(\epsilon)$.

## Ejemplo

<p align="center">

<img src="ejemplo1.png" width="1000"/>

</p>

## Características

Para cada red $\mathcal{G}_t$ se calculan 20 medidas teóricas de los grafos

1.  Distribución de triángulos:# de triángulos conectados a cada nodo
2.  Grado: \# de aristas conectado a cada nodo
3.  Densidad: \# de aristas observadas/total posibles aristas
4.  Total de aristas en $\mathcal{G}_t$
5.  Transitividad (*amigos de amigos*):Proporción de nodos cuyos nodos adyacentes también están conectados

## Características

6.  Asortatividad: Medición de la homofilia [^1] del grafo, basándose en las etiquetas de los nodos
7.  Distancia media: calcula la media de todos los caminos entre diferentes nodos
8.  Diámetro: Distancia más grande del grafo [^2]
9.  Proporción de nodos no conectados
10. Centralidad: Mide qué tan "cerca" está un nodo a otros nodos

[^1]: Nodos similares tienen a conectarse entre sí

[^2]: Distancia es la caminata más corta entre dos nodos

# Proceso de generación de red{.smaller}

El proceso que genera la red puede crear dependencias temporales dentro del espacio de características. Por ejemplo, si el número de conexiones en una red aumenta con el tiempo, una disminución repentina en el número de conexiones en un punto específico del tiempo se consideraría una anomalía. Es crucial capturar este comportamiento. Simplemente identificar anomalías en el espacio de características no nos permitiría señalar esa anomalía en particular, como se ilustra en la Figura 4.

-----

<p align="center">

<img src="figure_4.png" width="1000"/>

</p>

## Definición 2.4.

Los modelos ARIMA aproximan el proceso generador de la red con el parámetro $\delta$, si

$$
\tilde{p}_{t \mid t-1} \geq \delta \Longleftrightarrow \left\| \boldsymbol{e}_t \right\| \leq c(\delta),
$$

para valores pequeños de $\delta$. Esto asegura que los modelos ARIMA capturen los patrones generales, incluyendo la tendencia y la estacionalidad en el espacio de características, al mapear puntos de alta densidad en la distribución condicional $f\left(\mathcal{G}_t\right) \mid \mathcal{G}_1, \ldots, \mathcal{G}_{t-1}$ a residuos pequeños.

## Proposición 2.1.

Si una función $f$ satisface la Condición de Preservación de Anomalías con parámetro $\epsilon$, y si los modelos ARIMA aproximan el proceso generador de la red con parámetro $\delta$ con $\delta \geq \epsilon$, entonces un grafo anómalo $\mathcal{G}_t$ da lugar a una anomalía en el espacio de residuos de ARIMA, es decir, existe un valor pequeño $\xi$ tal que $\mathcal{P}\left(\boldsymbol{e}_t\right) \leq \xi$, donde $\xi=\xi(\delta)$ y $\boldsymbol{e}_t$ es el residuo correspondiente al grafo $\mathcal{G}_t$.

## 

# Reduccion de dimensionalidad y deteccion de anomalias

Es difícil identificar anomalías en dimensiones altas porque los puntos están muy lejos unos de otros y muchos puntos residen en regiones de baja densidad. Además, se pueden correlacionar errores de diferentes características.

## Metodos de reduccion

Reduccion de dos dimensiones y PCA Robusto

Para nuestros escenarios de red, una PCA robusta proporcionó un mejor rendimiento en comparación con dobin, posiblemente porque dobin no manejó las correlaciones tan bien como una PCA robusta.

El PCA usado utiliza una medida robusta de la varianza dada por Explicar que ingresa.

## Deteccion de anomalias

Deteccion por metodo de lookup, descrito asi:
